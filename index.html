<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProgramBI Communities | Admin Console</title>
    
    <!-- Fuentes Premium -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome 6 Pro -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Prism.js -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Estilos y Tailwind -->
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], heading: ['Poppins', 'sans-serif'], mono: ['Fira Code', 'monospace'] },
                    colors: { pbi: { black: '#09090b', white: '#FFFFFF', gray: '#FAFAFA', border: '#E5E7EB' } },
                    animation: { 'fade-in': 'fadeIn 0.4s ease-out forwards', 'slide-up': 'slideUp 0.4s ease-out forwards' }
                }
            }
        }
    </script>

    <!-- INICIALIZACI칍N PREVIA (Evita errores de carga en vistas) -->
    <script>
        window.App = { state: {}, routes: {}, api: {}, ui: {} };
    </script>
</head>
<body class="bg-[#FAFAFA] text-pbi-black font-sans antialiased overflow-hidden selection:bg-black selection:text-white">

    <!-- SPA CONTAINER -->
    <div id="app" class="h-screen w-full relative transition-opacity duration-300">
        <div class="flex h-full items-center justify-center flex-col">
            <div class="animate-pulse flex flex-col items-center">
                <div class="w-16 h-16 bg-black text-white rounded-2xl flex items-center justify-center text-2xl shadow-xl mb-6">
                    <i class="fas fa-cubes"></i>
                </div>
                <h1 class="text-xl font-heading font-bold text-gray-900">ProgramBI</h1>
                <p class="text-sm font-medium text-gray-400 mt-2">Conectando a la nube...</p>
            </div>
        </div>
    </div>

    <!-- OVERLAYS -->
    <div id="modal-overlay" class="fixed inset-0 z-[60] hidden bg-black/40 backdrop-blur-sm flex items-center justify-center p-4 transition-opacity opacity-0"></div>
    <div id="toast-container" class="fixed bottom-6 right-6 z-[70] flex flex-col gap-3 pointer-events-none"></div>

    <!-- DEPENDENCIAS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>

    <!-- FIREBASE INIT (CORE) -->
    <script type="module">
        // Importamos TODO lo necesario desde el CDN oficial
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, collection, getDocs, getDoc, addDoc, updateDoc, setDoc, doc, query, where, orderBy, arrayUnion, serverTimestamp, runTransaction, increment, arrayRemove, deleteDoc
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // TU CONFIGURACI칍N
        const firebaseConfig = {
            apiKey: "AIzaSyDTBdv1jZ-yo3-Kwq7aKZQSx3kiClhuP8Q",
            authDomain: "comunidad-649d2.firebaseapp.com",
            projectId: "comunidad-649d2",
            storageBucket: "comunidad-649d2.firebasestorage.app",
            messagingSenderId: "1069690355912",
            appId: "1:1069690355912:web:51dd90089623fbd8e465fd"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Exponemos las funciones al 치mbito global para que core.js (script est치ndar) las use
        window.F = {
            auth, db,
            signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile,
            collection, getDocs, getDoc, addDoc, updateDoc, setDoc, doc, query, where, orderBy, arrayUnion, serverTimestamp, runTransaction, increment, arrayRemove, deleteDoc,
            initialized: true
        };

        console.log("游댠 Firebase Ready: Services Exposed");
        window.dispatchEvent(new Event('firebase-ready'));
    </script>

    <!-- APP SCRIPTS -->
    <!-- 1. Datos Semilla (Solo migraci칩n) -->
    <script src="mockData.js"></script> 
    
    <!-- 2. N칰cleo del Sistema -->
    <script src="core.js"></script>

    <!-- 3. Componentes y M칩dulos (NUEVOS - Orden Cr칤tico) -->
    <script src="components.sidebar.js"></script> <!-- Debe cargar antes que las vistas -->
    <script src="community.lms.js"></script>     <!-- Motor Educativo -->

    <!-- 4. Controladores de Vistas -->
    <script src="auth.views.js"></script>
    <script src="dashboard.views.js"></script>
    <script src="community.views.js"></script>
    <script src="admin.views.js"></script>

</body>
</html>